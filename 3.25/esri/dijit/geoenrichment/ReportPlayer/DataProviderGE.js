// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See http://js.arcgis.com/3.25/esri/copyright.txt for details.
//>>built
define("esri/dijit/geoenrichment/ReportPlayer/DataProviderGE","dojo/_base/declare dojo/_base/lang dojo/promise/all dojo/when ./dataProvider/_CommandSupport ./dataProvider/_SerializationSupport ./dataProvider/_ServerSerializationSupport ./dataProvider/supportClasses/AnalysisAreaJsonUtil ./dataProvider/supportClasses/CustomReportsManager ./dataProvider/supportClasses/TemplateJsonLoader ./dataProvider/supportClasses/ReportDataProcessor ./dataProvider/supportClasses/InfographicOptionsProvider ./dataProvider/supportClasses/AreasPreprocessor ./dataProvider/supportClasses/AreasInfoTemplateBuilder ./dataProvider/supportClasses/GEUtil ./dataProvider/supportClasses/attachments/DefaultAttachmentsStore ./dataProvider/supportClasses/StandardGraphicReportTemplates ./core/themes/ThemeLibrary ./core/themes/ReportThemes ./core/supportClasses/templateJsonUtils/countryConfig".split(" "),
function(r,t,p,h,u,v,w,x,f,y,k,z,A,B,l,C,D,E,q,m){return r([u,v,w],{analysisAreasLimit:-1,cacheTemplates:!0,printMapTaskUrl:null,_infographicOptionsProvider:null,constructor:function(){this._infographicOptionsProvider=new z},_getAttachmentsStore:function(b){return(new C(b)).initialize()},getCustomReports:function(b,c){return f.getCustomReports(b,c)},_currentContext:null,getReportData:function(b,c){var e=this;c=c||function(){};var a=t.mixin({},b);a.reportID=D.aliasToID(a.countryID,a.reportID)||a.reportID;
a.analysisAreas=x.areasFromJson(a.analysisAreas);a.fieldData={runReportTaskID:null,metadata:{},areaData:[],errors:[]};this._currentContext=a;this._infographicOptionsProvider.setServerUrl(a);f.resetCache();return h(l.provideGeoenrichmentUrl(a),function(){return h(A.preprocessAreas(a,{analysisAreasLimit:e.analysisAreasLimit}),function(){c(.25);return p({initGE:l.initialize(a.geoenrichmentUrl),countryInfo:l.getCountryInfo(a.geoenrichmentUrl,a.countryID),reportObject:f.getCustomReportByID(a),infographicOptions:e._infographicOptionsProvider.getInfographicOptions(a),
attachmentsStore:e._getAttachmentsStore(a),templateJsonInfo:y.getTemplateJsonByID(a,e.cacheTemplates),runReportResult:k.runReportAndGetData(a)}).then(function(d){var b=d.reportObject,e=d.infographicOptions,g=d.attachmentsStore,n=d.templateJsonInfo.templateJson,f=d.templateJsonInfo.templateVariableProvider,h=d.runReportResult;c(.75);if(!n||!b||!a.fieldData)return null;k.applyRunReportAndGetDataResults(h,a);m.setCountry(d.countryInfo.country);m.setHierarchyID(b.hierarchy);m.setGeographiesModel(d.countryInfo.geographiesModels[m.getHierarchyID()]);
return p([g&&B.buildInfoTemplates(g,a.analysisAreas),g&&k.populateReportDataFromAttachmentsStore(a,g)]).then(function(){c(1);n.theme||(n.theme=E.getReportThemeById(b.isGraphicReport?q.GRAPHIC:q.CLASSIC));return{isClassic:!b.isGraphicReport,reportType:b.type,reportTitle:b.title,templateJson:n,reportObject:b,fieldData:a.fieldData,analysisAreas:a.analysisAreas,infographicOptions:e,attachmentsStore:g,geClient:l.getClient(),templateVariableProvider:f,config:{portalUrl:a.portalUrl,geoenrichmentUrl:a.geoenrichmentUrl,
countryID:a.countryID,reportID:a.reportID}}})})})})},_getCurrentContext:function(){return this._currentContext},enrichFieldData:function(b,c){return k.enrichFieldData(b,c)}})});