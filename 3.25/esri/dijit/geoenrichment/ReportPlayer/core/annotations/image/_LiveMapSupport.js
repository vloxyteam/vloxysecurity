// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See http://js.arcgis.com/3.25/esri/copyright.txt for details.
//>>built
define("esri/dijit/geoenrichment/ReportPlayer/core/annotations/image/_LiveMapSupport","dojo/_base/declare dojo/when dojo/dom-construct ../../supportClasses/map/legend/LegendController esri/dijit/geoenrichment/utils/InvokeUtil esri/dijit/geoenrichment/utils/WaitingUtil".split(" "),function(h,k,l,m,n,e){return h(null,{_isPlacingMapFlag:!1,_currentMap:null,_locatorPointsControllers:null,_placeMap:function(){return n.invoke(this,"_doPlaceMap")},_doPlaceMap:function(){function b(){a._currentMap&&a._currentMap.destroy();
a._currentMap=null}function g(){e.removeProgress(a.content);a._finalizePlaceMap();a._showErrorMessage(!0);a.onMapLoadError()}var a=this;this._showErrorMessage(!1);this._isPlacingMapFlag&&this._finalizePlaceMap();l.empty(this.content);b();e.showProgress(this.content);this.onContentLoadingStart();this._isPlacingMapFlag=!0;this._legendController=new m;this._legendController.showLegend=this._showLegend;this._additionalLayerInfos&&this.viewModel.dynamicReportInfo&&!this._locatorPointsControllers&&(this._locatorPointsControllers=
[],this._additionalLayerInfos.forEach(function(a,b){a.index=b;if(a.isLocatorLayer){var d=this.viewModel.getLocatorPointsController(a.calculatorInfo);d.setRendererJson(this._calculatorFieldName,a.rendererJson);d.setLayerIndex(this._calculatorFieldName,b);this.own(d);this._locatorPointsControllers.push(d)}},this));return k(this._createMapFunc(this.content,{defaultBasemapId:this._defaultBasemapId,webMapId:this._webMapId,additionalLayerInfos:this._additionalLayerInfos&&this._additionalLayerInfos.filter(function(a){return!!a.url}),
locatorPointsControllers:this._locatorPointsControllers,legendController:this._legendController,waitForLoad:!0,extent:this._mapExtentPending,calculatorFieldName:this._calculatorFieldName}),function(f){a._locatorPointsControllers&&a._locatorPointsControllers.forEach(function(b){b.setMapInfo(a._calculatorFieldName,f)});var c=f&&f.map;b();!a.domNode&&c?c.destroy():(a._currentMap=c)?(a.own(c),e.removeProgress(a.content),a._finalizePlaceMap()):g()},g)},_finalizePlaceMap:function(){this._isPlacingMapFlag&&
(this._isPlacingMapFlag=!1,this.onContentLoadingEnd())},isLegendVisible:function(){return this._showLegend},setLegendVisible:function(b){this._showLegend=b;this._legendController.setLegendVisible(b)},_mapExtentPending:null,getVisualState:function(){return{mapExtent:this._currentMap&&this._currentMap.extent,showLegend:this.isLegendVisible()}},setVisualState:function(b){this._mapExtentPending=null;b&&(b.mapExtent&&(this._currentMap&&this._currentMap.setExtent?this._currentMap.setExtent(b.mapExtent):
this._mapExtentPending=b.mapExtent),void 0!==b.showLegend&&this.setLegendVisible(b.showLegend))},destroy:function(){this._finalizePlaceMap();this.inherited(arguments)}})});