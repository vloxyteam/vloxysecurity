// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See http://js.arcgis.com/3.25/esri/copyright.txt for details.
//>>built
define("esri/dijit/geoenrichment/ReportPlayer/dataProvider/commands/CreateImageCommand","dojo/_base/declare dojo/when dojo/sniff ./CreateHTMLCommand ../../PlayerCommands ../../config ./supportClasses/ProgressSteps ./createHTML/CommandMode ./imageUtils/ImageSaveUtil ./imageUtils/NodeToCanvasUtil ./imageUtils/ImagePrintUtil ./createHTML/CSSFilesLoader dojo/i18n!esri/nls/jsapi".split(" "),function(h,k,f,l,m,n,c,p,q,r,t,u,e){e=e.geoenrichment.dijit.ReportPlayer.ReportPlayer;return h(l,{id:m.IMAGE,label:e.createImageCommandLabel,
errorMessage:e.createImageError,_saveFiles:!1,_stopPrintableContainer:!1,_mode:p.SVG,_mergePageIndexes:!1,execute:function(g,d){var b=this;return k(this.inherited(arguments),function(a){function e(a){if(!d.skipErrorNotification)return b._handleError(a)}if(a&&a.svgStrings){var f=a.svgStrings.length,h=function(a){b._stepFinished(c.RENDER_IMAGE,a+1,f)};a.svgStrings=b._preProcessSVGStrings(a.svgStrings);return k(u.loadCssFontFiles(),function(){return t.printImages({svgStrings:a.svgStrings,nodeToCanvasFunc:b._nodeToCanvasFunc.bind(b),
onRenderImage:h,scale:3}).then(function(c){return q.saveImages(c,{reportTitle:g.getReportTitle(),analysisAreas:g.getAnalysisAreas(),allAreas:b._printableContainer.needExportAllAreas(),numPages:b._printableContainer.getNumberOfPages(),confirmSaveFile:b._confirmSaveFile,skipSavingFile:d.skipSavingFile||n.createImageCommand.skipSavingFile,saveImageFunc:a.additionalFiles&&a.additionalFiles.length&&function(c){return b._saveMultipleFiles([c],a.additionalFiles)},saveMultipleImagesFunc:b._saveMultipleFiles&&
function(c){return b._saveMultipleFiles(c,a.additionalFiles)}})}).otherwise(e).always(function(a){return k(b._printableContainer&&b._printableContainer.stop(),function(){return a})})})}})},_saveMultipleFiles:null,_stepFinished:function(g,d,b){if(this._currentProgressBack){var a=0;switch(g){case c.REPLACE_MAPS:a=10;break;case c.PREPARE_DOM:a=20;break;case c.RENDER_PAGE:a=20+40*d/b;break;case c.UNSET_LAYOUT:a=70;break;case c.RENDER_IMAGE:a=70+30*d/b}this._currentProgressBack(a/100)}},_preProcessSVGStrings:function(c){return c},
_nodeToCanvasFunc:function(c,d,b){return r.svgNodeToCanvasFunc(c.children[0],d,b)},isBrowserSupported:function(){return!(f("ie")||f("trident"))}})});