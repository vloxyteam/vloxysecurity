// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See http://js.arcgis.com/3.25/esri/copyright.txt for details.
//>>built
define("esri/dijit/geoenrichment/ReportPlayer/dataProvider/commands/CreatePDFCommand","dojo/_base/declare dojo/_base/lang dojo/when esri/dijit/geoenrichment/utils/FileUtil esri/dijit/geoenrichment/utils/MaskUtil esri/dijit/geoenrichment/utils/JsonXmlConverter esri/dijit/geoenrichment/utils/requests/FileContent ./CreateHTMLCommand ../../PlayerCommands ../../config ./supportClasses/ProgressSteps ./createHTML/CommandMode ../supportClasses/GEUtil esri/dijit/geoenrichment/ReportPlayer/core/conversion/reportingEngine/converters/DocumentConverter esri/dijit/geoenrichment/ReportPlayer/core/conversion/ConversionUtil esri/dijit/geoenrichment/ReportPlayer/core/supportClasses/DocumentOptions esri/dijit/geoenrichment/ReportPlayer/core/sections/SectionTypes dojo/i18n!esri/nls/jsapi ../../_devConfig".split(" "),
function(l,m,g,n,p,q,r,t,u,v,c,w,k,x,h,y,z,a,A){a=a.geoenrichment.dijit.ReportPlayer.ReportPlayer;var B={buildLayoutXML:function(f){var e=x.buildDocumentTag({addDefaultQuery:!0,report:{templateJson:{documentOptions:m.mixin({},f.documentOptions,{left:0,right:0,top:0,bottom:0})}}}).documentTag,c=y.getPageBox(f.documentOptions),b=h.pxToPt(c.w),a=h.pxToPt(c.h);f.svgStrings.forEach(function(d,c){e.tags.push({name:"section",attributes:{type:z.DETAILS},tags:[{name:"img",attributes:{left:0,top:0,width:b,
height:a},tags:[{text:"__svgString__"+c+"__svgString__"}]}]});c<f.svgStrings.length-1&&e.tags.push({name:"pageBreak"})});var d=q.parseJson(e);f.svgStrings.forEach(function(b,c){d=d.replace("__svgString__"+c+"__svgString__",b)});return d}};return l(t,{id:u.PDF,label:a.createPDFCommandLabel,errorMessage:a.createPDFError,_saveFiles:!1,_stopPrintableContainer:!1,_mode:w.SVG,_requestSizeLimit:9E6,execute:function(f,e,a){var b=this,h=function(d){if(!e.skipErrorNotification)return b._handleError(d)};return g(this.inherited(arguments),
function(d){if(d&&d.svgStrings){var a=B.buildLayoutXML(d);A.createPDFCommand.removeUnicodeChars&&(a=p.removeXMLMasks(a,"X"));if(e.returnLayoutXMLOnly)return a;var g={report:f.getReportTitle(),format:"pdf",f:"bin"},a=r.fromFileData("report.xml",a);delete a.filename;g["report.xml"]=a;return k.formatReport(f.getReportData().config.geoenrichmentUrl,g).then(function(a){if(a&&a.data)return e.creditsTaskID&&k.consumeCredits(f.getReportData().config.geoenrichmentUrl,e.creditsTaskID),b._stepFinished(c.FORMAT_REPORT),
a={name:f.getReportTitle()+".pdf",data:a.data},e.skipSavingFile||v.createPDFCommand.skipSavingFile||(b._saveMultipleFiles&&d.additionalFiles&&d.additionalFiles.length?b._saveMultipleFiles(a,d.additionalFiles):n.saveAs(a.data,a.name)),a;h()})}}).otherwise(h).always(function(a){return g(b._printableContainer&&b._printableContainer.stop(),function(){return a})})},_saveMultipleFiles:null,_stepFinished:function(a,e,g){if(this._currentProgressBack){var b=0;switch(a){case c.REPLACE_MAPS:b=10;break;case c.PREPARE_DOM:b=
20;break;case c.RENDER_PAGE:b=20+60*e/g;break;case c.UNSET_LAYOUT:b=90;break;case c.FORMAT_REPORT:b=100}this._currentProgressBack(b/100)}}})});