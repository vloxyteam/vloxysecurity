// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See http://js.arcgis.com/3.25/esri/copyright.txt for details.
//>>built
define("esri/dijit/geoenrichment/ReportPlayer/dataProvider/commands/mapToImage/MapToURLUtil","dojo/_base/declare dojo/Deferred dojo/when dojo/dom-style esri/tasks/PrintTask esri/tasks/PrintParameters esri/tasks/PrintTemplate esri/dijit/geoenrichment/utils/UrlUtil esri/dijit/geoenrichment/utils/ImageInfoUtil ./LegendToLayerUtil".split(" "),function(m,n,g,h,p,q,r,t,u,v){var w=m(p,{_getPrintDefinition:function(b,a){var d=this.inherited(arguments);console.log(d);return d},_createOperationalLayers:function(b,
a){var d=this.inherited(arguments);if(a.__legendLayerId){var c=d.filter(function(b){return b.id===a.__legendLayerId})[0];d.splice(d.indexOf(c),1);d.push(c)}return d}}),c={mapToURL:function(b,a,d,e){var k=c._getUrlForMap(b);if(k)return k;a=g(a&&v.legendToGraphicsLayer(a,b,d),function(a){a&&b.addLayer(a);return g(c._runPrintTask(b,d,a,e),function(d){a&&b.removeLayer(a);var c=new n;setTimeout(function(){c.resolve(d.url)},100);return c.promise})});c._putUrlToCache(b,a);return a},_runPrintTask:function(b,
a,d,c){function e(){var c=new w(l),e=new q;e.map=b;var f=new r;f.exportOptions={width:3.125*h.get(a,"width"),height:3.125*h.get(a,"height"),dpi:300};f.format="png32";f.showAttribution=!1;f.__legendLayerId=d&&d.id;e.template=f;return c.execute(e)}var l=c.printMapTaskUrl||"https://utility.arcgisonline.com/arcgis/rest/services/Utilities/PrintingTools/GPServer/Export Web Map Task";t.registerCORS(l);return g(e(),function(a){return a},function(a){console.log(a);return g(e(),function(a){return a},function(a){console.log(a);
return e()})})},urlToSrc:function(b,a){return a.saveImagesAsDataUrl?u.getRemoteImageDataUrl(b,{sizeLimit:1500}):b}},e,x=0;c.enableCaching=function(){e={}};c.clearCaching=function(){e=null};c._putUrlToCache=function(b,a){e&&a&&(b.__mapToImageUtilKey=x++,e[b.__mapToImageUtilKey]=a)};c._getUrlForMap=function(b){return e&&e[b.__mapToImageUtilKey]};return c});