// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See http://js.arcgis.com/3.25/esri/copyright.txt for details.
//>>built
define("esri/dijit/geoenrichment/ReportPlayer/dataProvider/supportClasses/AreasPreprocessor","dojo/_base/Color dojo/when dojo/promise/all esri/graphic esri/symbols/SimpleFillSymbol esri/symbols/SimpleLineSymbol esri/tasks/FeatureSet ./FeatureNameUtil ./tasks/EnrichAreasTask ./CustomReportsManager esri/dijit/geoenrichment/utils/GeometryUtil".split(" "),function(g,d,f,q,r,h,k,t,l,m,n){var p={},e={symbolizeFeature:function(a){function c(){var b=new r;b.setOutline(new h(h.STYLE_SOLID,new g([105,134,68,
.55]),2));b.setColor(new g([105,134,68,.55]));return b}a.symbol||a.setSymbol(c())},symbolizeAreas:function(a){a.forEach(function(a){a.feature&&e.symbolizeFeature(a.feature)})}},v={generalize:function(a){var c=[],b=[];a.forEach(function(a,u){!a.feature||a.geographies&&a.geographies.length||(c.push(a.feature),b.push(u))});return d(function(b,a){a=void 0!==a?a:0;a=n.needGeneralizeGeometry(b,0<a?3*a:-3,0);var c;a&&(b=b.map(function(a){return new q(a.geometry,a.symbol,a.attributes)}),c=n.generalizeGeometry(b,
a,0,!0));return d(c,function(){return b})}(c),function(c){b.forEach(function(b){a[b].feature=c[b]})})}},w={provideGeographyFeatures:function(a){return d(m.getCustomReportByID(a),function(c){return f(a.analysisAreas.map(function(b){if(!b.feature&&b.geographies&&b.geographies.length)return(new l).createFeatureForGeographies(b.geographies,{countryID:a.countryID,hierarchy:c.hierarchy,geoenrichmentUrl:a.geoenrichmentUrl}).then(function(a){a=new k(a[0]);b.feature=a.features[0];e.symbolizeFeature(b.feature)})}))})}},
x={provideBufferFeatures:function(a){return d(m.getCustomReportByID(a),function(c){return f(a.analysisAreas.map(function(b){if(!b.feature&&b.buffer)return(new l).createFeatureForBuffer(b.buffer,{countryID:a.countryID,hierarchy:c.hierarchy,geoenrichmentUrl:a.geoenrichmentUrl}).then(function(a){a=new k(a[0]);b.feature=a.features[0];e.symbolizeFeature(b.feature)})}))})}};p.preprocessAreas=function(a,c){a.analysisAreas=a.analysisAreas.filter(function(a){return a.feature&&a.feature.geometry&&"polygon"===
a.feature.geometry.type||a.geographies&&a.geographies.length||a.buffer});-1!==c.analysisAreasLimit&&(c.analysisAreasLimit=c.analysisAreasLimit||10,a.analysisAreas.length=Math.min(a.analysisAreas.length,c.analysisAreasLimit));a.analysisAreas.forEach(function(a){a.feature&&!a.feature.attributes&&(a.feature.attributes={})});a.analysisAreas.forEach(function(a){a.name=a.name||a.shortName;if(!a.name&&a.feature){var b=t.guessFeatureName(a.feature);b&&(a.name=a.shortName=b)}});c.symbolizeAreas&&e.symbolizeAreas(a.analysisAreas);
return d(v.generalize(a.analysisAreas),function(){return f([w.provideGeographyFeatures(a),x.provideBufferFeatures(a)])})};return p});